# because apple:
if [[ `uname` == "Darwin" ]]; then
    alias gdb='sudo gdb'
fi

# Python Virtualenvs
venv_utils () {
    # We use 'venv.nosync' to make icloud ignore it, then the symlink is used to
    # 'remove' the '.' from the name so that pylint from Atom can see it
    virtualenv -p python$1 venv.nosync
    source ./venv.nosync/bin/activate
    pip install pylint
    ln -s venv.nosync venv
}

conda_utils () {
    # We use venv.nosync to make icloud ignore it, then the symlink is used to
    # 'remove' the '.' from the name so that pylint from Atom can see it
    conda create -n venv.nosync python=$1 anaconda
    source activate venv.nosync
    conda install -n venv.nosync pylint
    ln -s  /Users/daniellombardi/anaconda3/envs/venv.nosync venv
}

pip_freeze() {
    pipreqs --use-local # https://github.com/bndr/pipreqs
    # pip uninstall pylint -y > /dev/null 2>&1
    # pip freeze > requirements.txt
    # pip install pylint > /dev/null 2>&1
}

create_from_template () {

    source_dir=${HOME}/dotfiles/TEMPLATES/${1}

    copied_files=()
    for file_path in $source_dir/(.[^.]*|*); do
        file="$(basename $file_path)"

        if [[ ! -f "./${file}" ]]; then
            cp ${HOME}/dotfiles/TEMPLATES/${1}/${file} .
            copied_files+=("${file}")
        else
            echo "Unable to include batteries for: \"${file}\""
        fi

    done

    new_line=0
    for file_name in "${copied_files[@]}"; do
        echo -n "${file_name}\t"
        new_line=1
    done

    if [ "${new_line}" -eq 1 ]; then
        echo ""
    fi

}

start_OS_dev_env_NO_COLIMA () {

    docker ps > /dev/null 2>&1
    if [ $? -eq 1 ]; then
        echo "Launching Docker..."
        open -a docker

        docker ps > /dev/null 2>&1
        while [ $? -eq 1 ]
        do
            sleep 1
            docker ps > /dev/null 2>&1
        done
    fi

    docker run --rm -it -v $(pwd):/usr/src gcc:latest # "cd /usr/src && ls"
}

start_OS_dev_env () {

    docker ps > /dev/null 2>&1
    if [ $? -eq 1 ]; then
        colima start
    fi

    # docker run --rm -it -v $(pwd):/usr/src/project -w="/usr/src/project" gcc:latest "/bin/sh"

    docker run --rm -it -v "`pwd`:/usr/src/project" gcc:latest /bin/sh -c "cd /usr/src/project && ls && /bin/bash"

    RED='\033[0;31m'
    NC='\033[0m' # No Color

    echo $RED
    echo "Don't forget to run 'colima stop' if you're done using containers."
    echo $NC
    # colima stop
}

# python venvs
alias mkconda="conda_utils '3.7'"
alias mkconda3.7="conda_utils '3.7'"
alias mkconda3.8="conda_utils '3.8'"
alias mkconda3.9="conda_utils '3.9'"

alias mkvenv3.7="venv_utils '3.7'"
alias mkvenv3.8="venv_utils '3.8'"
alias mkvenv3.9="venv_utils '3.9'"
alias mkvenv=venv_utils

alias activenv='source ./venv.nosync/bin/activate'
alias acticonda='source ~/anaconda3/envs/venv.nosync/bin/activate'

alias condadel='conda remove -n venv.nosync -all'

alias pipfrz=pip_freeze

# school work templates
alias mkcpp="create_from_template 'CPP'"
alias mkcpproj="create_from_template 'CPP_PROJECT'"
alias mkc="create_from_template 'C'"
alias mkso="create_from_template 'OS'"
alias mkos="create_from_template 'OS'"


# docker and SO
alias here=start_OS_dev_env
alias ghidra=ghidraRun
